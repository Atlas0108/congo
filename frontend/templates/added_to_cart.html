{% extends "base.html" %}

{% block title %}Added to Cart - Congo{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 py-8">
    <div class="flex gap-8">
        <!-- Left Section: Product Details -->
        <div class="flex-1 bg-white p-6">
            <div class="flex gap-6 items-start">
                <!-- Product Image -->
                <div class="flex-shrink-0">
                    <img id="product-image" src="/static/images/placeholder.svg" alt="Product" class="w-24 h-32 object-contain bg-gray-50 rounded">
                </div>
                
                <!-- Product Info -->
                <div class="flex-1">
                    <div class="flex items-center gap-3 mb-3">
                        <svg class="w-8 h-8 text-green-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span class="font-bold text-lg">Added to cart</span>
                    </div>
                    <div id="product-specs" class="text-sm text-gray-700 space-y-1">
                        <!-- Product specifications will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Right Section: Cart Summary -->
        <div class="w-80 flex-shrink-0 bg-gray-50 p-6 rounded-lg">
            <div class="mb-6">
                <div class="text-sm text-gray-700 mb-1">Cart Subtotal:</div>
                <div class="text-2xl font-semibold">
                    $<span id="cart-subtotal-dollars">0</span><sup class="text-base font-normal">.<span id="cart-subtotal-cents">00</span></sup>
                </div>
            </div>
            
            <div class="space-y-3">
                <a href="/cart" id="proceed-to-checkout-btn" class="btn-success btn-primary-lg block text-center whitespace-nowrap" style="width: 280px;">
                    Proceed to checkout (<span id="cart-item-count">0</span> items)
                </a>
                <a href="/cart" class="block bg-white border border-gray-300 hover:bg-gray-50 text-center font-medium py-3 px-4 rounded-lg transition whitespace-nowrap" style="width: 280px;">
                    Go to Cart
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Get product ID from URL
    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('product_id');
    
    if (!productId) {
        // Redirect to products if no product ID
        window.location.href = '/products';
        return;
    }
    
    // Load product details
    fetch(`/api/products/${productId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Product not found');
            }
            return response.json();
        })
        .then(product => {
            // Update product image
            const productImage = document.getElementById('product-image');
            if (product.image_url) {
                productImage.src = product.image_url;
                productImage.onerror = function() {
                    this.src = '/static/images/placeholder.svg';
                };
            }
            
            // Update product specifications
            const productSpecs = document.getElementById('product-specs');
            const specs = [];
            // Add category as "Color" if available, or use a default
            if (product.category) {
                specs.push(`<div><span class="font-medium">Category:</span> ${product.category}</div>`);
            }
            // Add size/other details if available
            if (product.description) {
                const descParts = product.description.split(',').slice(0, 2);
                descParts.forEach(part => {
                    if (part.trim()) {
                        specs.push(`<div>${part.trim()}</div>`);
                    }
                });
            }
            productSpecs.innerHTML = specs.length > 0 ? specs.join('') : '<div>Product added to cart</div>';
        })
        .catch(error => {
            console.error('Error loading product:', error);
        });
    
    // Load cart summary
    function loadCartSummary() {
        // Add a small delay to ensure cart is updated after adding item
        setTimeout(() => {
            fetch('/api/cart/')
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    return [];
                })
                .then(cart => {
                    let subtotal = 0;
                    let itemCount = 0;
                    
                    if (Array.isArray(cart) && cart.length > 0) {
                        cart.forEach(item => {
                            if (item.product && item.product.price && item.quantity) {
                                subtotal += parseFloat(item.product.price) * parseInt(item.quantity);
                                itemCount += parseInt(item.quantity);
                            }
                        });
                    }
                    
                    // Update cart subtotal
                    const priceParts = subtotal.toFixed(2).split('.');
                    const dollarsEl = document.getElementById('cart-subtotal-dollars');
                    const centsEl = document.getElementById('cart-subtotal-cents');
                    if (dollarsEl) dollarsEl.textContent = priceParts[0];
                    if (centsEl) centsEl.textContent = priceParts[1];
                    
                    // Update item count
                    const countEl = document.getElementById('cart-item-count');
                    if (countEl) countEl.textContent = itemCount;
                })
                .catch(error => {
                    console.error('Error loading cart:', error);
                });
        }, 300);
    }
    
    loadCartSummary();
</script>
{% endblock %}

