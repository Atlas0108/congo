{% extends "base.html" %}

{% block title %}My Orders - Congo{% endblock %}

{% block content %}
<h1 class="text-3xl font-bold mb-6">My Orders</h1>
<div id="orders-container">
    <div class="bg-white rounded-lg shadow-md p-6">
        <p class="text-center text-gray-500">Loading orders...</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    fetch('/api/orders/')
        .then(response => {
            if (response.ok) {
                return response.json();
            }
            throw new Error('Not authenticated');
        })
        .then(orders => {
            const container = document.getElementById('orders-container');
            if (orders.length === 0) {
                container.innerHTML = '<div class="bg-white rounded-lg shadow-md p-6"><p class="text-center text-gray-500">You have no orders yet.</p></div>';
            } else {
                container.innerHTML = orders.map(order => `
                    <div class="bg-white rounded-lg shadow-md p-6 mb-4">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-semibold">Order #${order.id}</h3>
                                <p class="text-gray-600">Placed on ${new Date(order.created_at).toLocaleDateString()}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-2xl font-bold text-gray-900">$${order.total_amount.toFixed(2)}</p>
                                <span class="px-3 py-1 rounded-full text-sm" style="background-color: #004FFF; color: white;">${order.status}</span>
                            </div>
                        </div>
                        <div class="border-t pt-4">
                            <h4 class="font-semibold mb-2">Items:</h4>
                            <ul class="space-y-2">
                                ${order.items.map(item => `
                                    <li class="flex justify-between">
                                        <span>${item.product.name} x ${item.quantity}</span>
                                        <span>$${(item.price * item.quantity).toFixed(2)}</span>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        <div class="mt-4 pt-4 border-t">
                            <p class="text-sm text-gray-600"><strong>Shipping to:</strong> ${order.shipping_address}</p>
                        </div>
                    </div>
                `).join('');
            }
        })
        .catch(() => {
            document.getElementById('orders-container').innerHTML = '<div class="bg-white rounded-lg shadow-md p-6"><p class="text-center text-gray-500">Please <a href="/login" style="color: #004FFF;" class="hover:opacity-80">login</a> to view your orders.</p></div>';
        });
</script>
{% endblock %}

